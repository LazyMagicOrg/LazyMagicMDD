# LazyMagic Detailed Documentation

## 1. Project Overview

LazyMagic is a sophisticated code generation and project management tool designed for .NET solutions, particularly those involving API development and serverless architectures. It uses a YAML configuration file to define the structure and components of a solution, then generates the necessary projects, code, and configuration files.

## 2. Core Components

### 2.1 Configuration Parsing

- **LazyMagic.yaml**: The main configuration file that defines the solution structure.
- **YamlTypeConverterBase**: A base class for custom YAML converters.
- **DirectivesPropertyConverter**: Converts the YAML representation of Directives into strongly-typed objects.
- **DirectivePropertyConverter**: Handles conversion of individual Directive objects.
- **ArtifactsPropertyConverter**: Manages conversion of Artifacts defined in the YAML.
- **ArtifactPropertyConverter**: Converts individual Artifact definitions.

### 2.2 Directives

Directives are the main building blocks of a LazyMagic solution configuration. They define different aspects of the solution structure:

- **Schema**: Represents data models and DTOs.
- **Module**: Defines a logical grouping of functionality.
- **Container**: Represents a deployable unit, typically containing multiple modules.
- **Api**: Defines an API surface, composed of one or more containers.
- **Deployment**: Specifies deployment configurations.

Each directive type has its own class (e.g., `Schema`, `Module`, etc.) inheriting from `DirectiveBase`.

### 2.3 Artifacts

Artifacts represent the actual output generated by LazyMagic:

- **DotNetSchemaProject**: Generates schema-related code and projects.
- **DotNetRepoProject**: Creates repository projects.
- **DotNetControllerProject**: Generates controller projects.
- **DotNetLambdaProject**: Creates AWS Lambda projects.
- **DotNetWebApiProject**: Generates ASP.NET Web API projects.
- **AwsServerlessHttpApi**: Represents an AWS Serverless HTTP API.

## 3. Key Features

### 3.1 OpenAPI Integration

- **OpenApiDocument**: Represents a merged OpenAPI specification.
- **LoadOpenApiFilesAsync**: Loads and merges multiple OpenAPI specification files.
- **NSwag Integration**: Uses NSwag for generating C# client code from OpenAPI specs.

### 3.2 Code Generation

- Generates DTOs, Models, and Validators based on OpenAPI schemas.
- Creates project files (.csproj) and folder structures.
- Generates boilerplate code for various project types.

### 3.3 Default Handling and Inheritance

- Implements a system for applying default values to directives.
- Allows for inheritance-like behavior in the configuration.
- Uses `AssignDefaults` method in directive classes to merge default values.

### 3.4 Validation

- Uses FluentValidation for validating configuration and generated objects.
- Each directive type has its own validator (e.g., `SchemaValidator`, `ModuleValidator`).

### 3.5 Logging and Error Handling

- Incorporates an `ILogger` interface for consistent logging across the project.
- `DetailedErrorNodeDeserializer`: Provides detailed error information during YAML parsing.
- Custom exception types for specific error scenarios.

## 4. Key Classes and Their Roles

### 4.1 SolutionBase

- Base class for representing a LazyMagic solution.
- Holds the Directives and provides methods for loading OpenAPI specs.

### 4.2 LzSolution

- Derived from `SolutionBase`.
- Manages the overall process of loading configuration and generating the solution.

### 4.3 DirectiveBase

- Base class for all directive types.
- Provides common properties and methods for directives.

### 4.4 ArtifactBase

- Base class for all artifact types.
- Defines common properties and methods for artifacts.

### 4.5 DotNetProjectBase

- Base class for .NET project artifacts.
- Defines properties common to all .NET projects.

## 5. Workflow

1. The tool reads the LazyMagic.yaml file.
2. YAML is parsed into Directive and Artifact objects.
3. Default values are applied to directives.
4. Directives are validated.
5. OpenAPI specifications are loaded and merged.
6. Artifacts are processed, generating the necessary code and project files.
7. The complete solution structure is created based on the configuration.

## 6. Extensibility

The project is designed for extensibility:
- New directive types can be added by creating new classes derived from `DirectiveBase`.
- New artifact types can be created by deriving from `ArtifactBase` or `DotNetProjectBase`.
- Custom YAML converters can be implemented for new types by inheriting from `YamlTypeConverterBase`.

## 7. Conclusion

LazyMagic provides a powerful, configuration-driven approach to creating complex .NET solutions. By automating much of the boilerplate code and project setup, it allows developers to focus on business logic while ensuring consistency across the solution architecture.